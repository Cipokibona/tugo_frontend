<div class="container-fluid chat-container p-0">

  <div class="chat-header d-flex align-items-center px-3 py-2 shadow-sm">
    <button class="btn btn-light btn-sm rounded-circle me-2" (click)="goBack()">
      <i class="fa fa-arrow-left"></i>
    </button>

    <div class="avatar me-2">{{ user?.username?.charAt(0)?.toUpperCase() || 'U' }}</div>

    <div class="flex-grow-1">
      <div class="fw-semibold">Conversation #{{ conversationId || '-' }}</div>
      <div class="text-success small">Messages</div>
    </div>
  </div>

  <div class="chat-body px-3 py-3">
    @if(loadingMessages){
      <div class="small text-muted">Loading messages...</div>
    } @else if (errorMessage) {
      <div class="small text-danger">{{ errorMessage }}</div>
    } @else if (messages.length === 0) {
      <div class="small text-muted">No messages in this conversation yet.</div>
    } @else {
      @for(message of messages; track message.id) {
        <div class="message" [class.sent]="isSentByMe(message)" [class.received]="!isSentByMe(message)">
          <div class="bubble">
            {{ messageContent(message) }}
          </div>
          <div class="time">
            {{ messageTime(message) }}
          </div>
        </div>
      }
    }
  </div>

  <div class="chat-input d-flex align-items-center px-2 py-2 shadow-lg">
    <input
      type="text"
      class="form-control form-control-sm rounded-pill me-2"
      placeholder="Type a message..."
      [(ngModel)]="messageText"
      (keyup.enter)="sendMessage()"
    >
    <button
      class="btn button principal btn-sm rounded-circle"
      [disabled]="sendingMessage || !messageText.trim() || !conversationId"
      (click)="sendMessage()"
    >
      @if(!sendingMessage){
        <i class="fa-solid fa-paper-plane"></i>
      } @else {
        <i class="spinner-border spinner-border-sm"></i>
      }
    </button>
  </div>

</div>
